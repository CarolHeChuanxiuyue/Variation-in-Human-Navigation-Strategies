---
title: "Variation in Human Navigation Strategies"
author: "Carol"
date: "1/3/2021"
output: html_document
---

## Objectives
The following analyses are used to compare human trajectories with simulated trajectories generated by path planning algorithms from robotics (simulation codes can be seen [here](https://github.com/jkrichma/PathPlanning)).

The results will be published in Topics in Cognitive Science ( [TopiCS](https://onlinelibrary.wiley.com/journal/17568765)).

The article link will be updated here after this publication is available online.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=11, fig.height=5)
setwd("~/Documents/Research/Forth_Year_Projects/TopicsCS/Jeff/Analysis")
library(tidyverse)
```

## Minimum Frechet Distance

First, we used different strategy-based path algorithms to simulate different navigation strategy-based trajectories given 20 trials. These 20 trials have different start and end locations within the same virtual maze. (See [here](https://github.com/jkrichma/PathPlanning))). There are 14 strategies can be used for each trial.

Next, we used the [Frechet distance](https://en.wikipedia.org/wiki/Fr%C3%A9chet_distance) to calculate how close the strategy resembled the path taken by each subject. Then, we found the minimum frechet distance for each human trajectory to show on this trial which strategy the human subject used.

#### load minimum Frechet Distance data
```{r}
df <- read.csv('minFrechet2.csv')
```

All: The minimum Frechet Distance among all 14 strategies for each human trajectory.
Pure: The minimum Frechet Distance among 4 pure strategies for each human trajectory.
Six: The minimum Frechet Distance among 6 major strategies for each human trajectory.
Mix: The minimum Frechet Distance among 10 mixed strategies (not pure) for each human trajectory.

```{r}
summary(df)
```

**The following wilcox.test show the mean rank of the Frechet Distance distribution based on all 14 strategies is significantly lower than the mean rank pf the Frechet Distance distribution based on 4 pure strategies**
```{r}
wilcox.test(df$Pure,df$All, paired = T, alternative = "two.sided")
```

## Strategy Use in the Goto Goal versus Shortcut Condition (Human Subjects)

### Goto Goal condition
#### load strategy used in the Goto Goal condition
```{r}
df <- read.csv('strategyGoto.csv')
```

- 206 human subjects. Each row represents one subject
- 20 trials for each subject. Each column represents one trial
- The cell value indicates which strategy (1-14) the subject used on this trial

**data transformation**
```{r}
df_long <- gather(df, Trial, Strategy, T2:T24, factor_key=TRUE)
df_long$Instr <- 'Goto Goal'
head(df_long)
```

### Shortcut condition
#### load strategy used in the Shortcut condition
```{r}
df2 <- read.csv('strategyShortcut.csv')
df2_long <- gather(df2, Trial, Strategy, T2:T24, factor_key=TRUE)
df2_long$Instr <- 'Shortcut'
head(df2_long)
```

### Merge data of two conditions
```{r}
dfstrategy <- rbind.data.frame(df_long,df2_long)
dfstrategy$Strategy <- as.factor(dfstrategy$Strategy)
```

### Show Distribution of Strategy Use in the Goto Goal condition (Figure 6a)
```{r}
ggplot(dfstrategy[dfstrategy$Instr=="Goto Goal",],aes(x=Strategy))+
  geom_bar(aes(y = (..count..)/sum(..count..)))+
  scale_x_discrete(labels=c("Sur","Top","Rte","Rev","SurRte","TopRte","SurRev",
                            "TopRev","RteSur","RteTop","RevSur","RevTop","SurTop","TopSur"))+
  ylab("Proportion")+
  xlab("Strategy")+
  ggtitle("A.Goto Goal Instruction")+
  theme_bw(base_size = 20)+
  theme(plot.title = element_text(hjust = 0.5))
#ggsave("gotoGoal.png",width=12,height = 5)
```

### Show Distribution of Strategy Use in the Shortcut condition (Figure 6b)
```{r}
ggplot(dfstrategy[dfstrategy$Instr=="Shortcut",],aes(x=Strategy))+
  geom_bar(aes(y = (..count..)/sum(..count..)))+
  scale_x_discrete(labels=c("Sur","Top","Rte","Rev","SurRte","TopRte","SurRev",
                            "TopRev","RteSur","RteTop","RevSur","RevTop","SurTop","TopSur"))+
  ylab("Proportion")+
  xlab("Strategy")+
  ggtitle("B.Shortcut Instruction")+
  theme_bw(base_size = 20)+
  theme(plot.title = element_text(hjust = 0.5))
#ggsave("shortCut.png",width=12,height = 5)
```

### Get Frequency table for strategy use in different conditions
```{r}
dfs_sum <- dfstrategy%>%group_by(Instr,Strategy)%>%
  summarise(
    n=n()
  )
dfs_sum [nrow(dfs_sum ) + 1,] <-  c('Shortcut','13',0)
dfs_sum$n <- as.numeric(dfs_sum$n)
dfs_sum
```

**data transformation**
```{r}
dfs_sum_w <- reshape2::dcast(dfs_sum, Strategy~Instr, value.var="n")
dt <- as.table(t(as.matrix(dfs_sum_w[,-1])))
colnames(dt) <-  c("Sur","Top","Rte","Rev","SurRte","TopRte","SurRev",
                          "TopRev","RteSur","RteTop","RevSur","RevTop","SurTop","TopSur")
dt
```

### Chi-square test

**Show the correlation between strategy use and condition**
```{r}
chi.tst <- chisq.test(dt)
chi.tst
chi.tst$statistic
chi.tst$residuals
```

### Visualization: Pearson Residuals of Chi-square Independence Test (Figure 6c)
```{r}
library(corrplot)
#jpeg("residul.png", width = 12, height = 2.5, units = 'in', res = 300)
title <- "C.Pearson Residuals of Chi-square Independence Test"
corrplot(chi.tst$residuals,is.cor = FALSE,method = "color",title=title,mar=c(0,0,1,0))
#dev.off()
```

### Visualization: Relative Contribution of Each Cell to the Total Chi-square Score (Figure 6d)

```{r}
contrib <- 100*chi.tst$residuals^2/chi.tst$statistic
round(contrib, 3)
```

```{r}
#jpeg("contribu.png", width = 12, height = 2.5, units = 'in', res = 300)
title <- "D.Relative Contribution of Each Cell to the Total Chi-square Score"
corrplot(contrib, is.cor = FALSE,title=title,mar=c(0,0,1,0))
#dev.off()
```

##Strategy Variation (SV) distribution

SV indicates how likely each subject varies his strategies across 20 trials.

#### load SV data for both conditions
```{r}
svgtg <- read.csv('SVGotoGoal.csv')
svst <- read.csv('SVShortcut.csv')
svgtg$Instr <- 'Goto Goal'
svst$Instr <- 'Shortcut'
sv <- rbind(svgtg,svst)
colnames(sv)[1] <- 'SV'
```


### Visualize distributions of SV in two conditions (Figure 8)

```{r, fig.width=8, fig.height=5}
library(viridis)
library(hrbrthemes)
ggplot(sv, aes(x=Instr, y=SV, fill=Instr,color=Instr))+
  geom_violin()+
  scale_fill_viridis(discrete = TRUE, alpha=0.7, option="B")+
  scale_color_viridis(discrete = TRUE, alpha=1, option="E")+
  geom_jitter(height = 0, width = 0.1,alpha=0.3)+
  scale_x_discrete(name = "Instructions",labels=c("Goto Goal","Shortcut"))+
  ylim(0.05,.97)+
  ylab("Strategy Variation")+
  theme_ipsum(base_size = 20, axis_title_size = 20)+
  theme(
      legend.position="none",
    )
#ggsave("SV.png",width = 8,height = 5)
```

### t-test for SV

**The following independent t-test shows the mean of SV in the Go toGoal conditioon is not significantly different from the mean of SV in the Shortcut condition**
```{r}
t.test(sv$SV~sv$Instr,var.equal=T)
```

**The following one-sample t-test shows the mean of SV in both conditioons is significantly smaller than 0.965 (which is theoretically largest value of SV, indicating no variation across 20 trials).**
```{r}
t.test(sv$SV,mu=0.965)
```

## The second set of simulation for cost investigation

####load simulated agents' strategies

- GotoGoal condition (16:1 map)
- Shortcut condition (2:1 map)
```{r}
simgtg <- read.csv('SimGotoGoal.csv')
simst <- read.csv('SimShortcut.csv')
```

**data transformation**
```{r}
simgtg$Instr <- 'Goto Goal'
simst$Instr <- 'Shortcut'
sim <- rbind(simgtg,simst)
colnames(sim)[1] <- 'Strategy'
sim_sum <- sim%>%group_by(Instr,Strategy)%>%
  summarise(
    n=n()
  )
sim_sum_w <- reshape2::dcast(sim_sum, Strategy~Instr, value.var="n")
sim_sum_w
```

### Show Distribution of Strategy Use in the simulated Goto Goal condition (Figure 10a)
```{r}
ggplot(sim[sim$Instr=="Goto Goal",],aes(x=Strategy))+
  geom_bar(aes(y = (..count..)/sum(..count..)))+
  scale_x_continuous(name="Strategy", breaks =c(1:11),labels=c("Sur","Top","Rte","Rev","SurRte","TopRte","SurRev",
                            "TopRev","RteSur","RteTop","RevSur"))+
  ylab("Proportion")+
  xlab("Strategy")+
  ggtitle("A.Simulation of Goto Goal")+
  theme_bw(base_size = 20)+
  theme(plot.title = element_text(hjust = 0.5))
#ggsave("simgotoGoal.png",width=10,height = 5)
```

### Show Distribution of Strategy Use in the simulated Shortcut condition (Figure 10b)
```{r}
ggplot(sim[sim$Instr=="Shortcut",],aes(x=Strategy))+
  geom_bar(aes(y = (..count..)/sum(..count..)))+
  scale_x_continuous(name="Strategy", breaks =c(1:11),labels=c("Sur","Top","Rte","Rev","SurRte","TopRte","SurRev",
                            "TopRev","RteSur","RteTop","RevSur"))+
  ylab("Proportion")+
  xlab("Strategy")+
  ggtitle("B.Simulation of Shortcut")+
  theme_bw(base_size = 20)+
  theme(plot.title = element_text(hjust = 0.5))
#ggsave("simshortCut.png",width=10,height = 5)
```

### Show simulated results are similar to human results

For more discussions on these results, see section 3.2 in the paper
```{r}
dfs_sum
```

```{r}
#Rte or Rev strategies -Goto Goal
prop.test(c(25,1121+444),c(80,4120))
```
```{r}
#Rte or Rev strategies -Shortcut
prop.test(c(14,542+336),c(80,4120))
```
```{r}
#route to survey -Goto Goal
prop.test(c(7,144+185),c(80,4120))
```
```{r}
#route to survey -Shortcut
prop.test(c(4,142+155),c(80,3240))
```